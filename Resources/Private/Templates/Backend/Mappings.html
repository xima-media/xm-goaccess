{namespace be=TYPO3\CMS\Backend\ViewHelpers}<h1>Request log ({requests->f:count()})</h1>

<f:form object="{demand}" class="demand-form">
    <div class="d-flex flex-row gap-4 mb-3">
        <div class="form-check form-switch">
            <f:form.checkbox class="form-check-input"
                             name="showIgnored"
                             property="showIgnored"
                             value="1"
                             id="displayIgnored" />
            <label class="form-check-label" for="displayIgnored"> Show ignored paths</label>
        </div>

        <div class="form-check form-switch">
            <f:form.checkbox class="form-check-input"
                             name="showPages"
                             property="showPages"
                             value="1"
                             id="displayPages" />
            <label class="form-check-label" for="displayPages"> Show page mappings</label>
        </div>

        <div class="form-check form-switch">
            <f:form.checkbox class="form-check-input"
                             name="showActions"
                             property="showActions"
                             value="1"
                             id="displayActions" />
            <label class="form-check-label" for="displayActions">Show action mappings</label>
        </div>

        <div class="form-check form-switch">
            <f:form.checkbox class="form-check-input"
                             name="showRedirects"
                             property="showRedirects"
                             value="1"
                             id="displayRedirects" />
            <label class="form-check-label" for="displayRedirects">Show redirect mappings</label>
        </div>
    </div>
</f:form>

<f:variable name="returnUrl" value="{f:be.uri(route: 'system_XmGoaccessGoaccess')}" />

<table data-table="requests" class="table table-striped table-hover mb-0">
    <thead>
    <tr>
        <th>Besucher</th>
        <th>Anfragen</th>
        <th>Path</th>
        <f:if condition="{demand.showPages}">
            <th>Page</th>
        </f:if>
        <f:if condition="{demand.showRedirects}">
            <th>Redirect</th>
        </f:if>
        <f:if condition="{demand.showActions}">
            <th>Action</th>
        </f:if>
        <f:if condition="{demand.showIgnored}">
            <th>Ignored</th>
        </f:if>
        <th></th>
    </tr>
    </thead>
    <tbody data-multi-record-selection-row-selection="true">
    <f:for each="{requests}" as="request">
        <tr>
            <td>{request.visitors}</td>
            <td>{request.hits}</td>
            <td>
                <f:if condition="{request.mapping}">
                    <f:then>
                        <be:link.editRecord uid="{request.mapping.uid}"
                                            table="tx_xmgoaccess_domain_model_mapping"
                                            returnUrl="{returnUrl}">
                            {request.path}
                        </be:link.editRecord>
                    </f:then>
                    <f:else>
                        <be:link.newRecord defaultValues="{tx_xmgoaccess_domain_model_mapping: {path:request.path}}"
                                           table="tx_xmgoaccess_domain_model_mapping"
                                           returnUrl="{returnUrl}">{request.path}
                        </be:link.newRecord>
                    </f:else>
                </f:if>
            </td>
            <f:if condition="{demand.showPages}">
                <td class="nowrap">
                    <f:for each="{request.mappings}" as="mapping">
                        <f:if condition="{mapping.recordType} === 0">
                            <be:link.editRecord uid="{mapping.uid}"
                                                table="tx_xmgoaccess_domain_model_mapping"
                                                returnUrl="{returnUrl}"
                                                class="btn btn-default btn-sm">
                                <f:if condition="{mapping.iconMarkup}">
                                    {mapping.iconMarkup->f:format.raw()}
                                </f:if>
                                <f:if condition="{mapping.pagePath}">
                                    {mapping.pagePath}
                                </f:if>
                            </be:link.editRecord>
                            <f:be.link route="web_layout"
                                       parameters="{id: mapping.page}"
                                       class="btn btn-default btn-sm">
                                <core:icon identifier="actions-window-open" size="small" />
                            </f:be.link>
                        </f:if>
                    </f:for>
                </td>
            </f:if>
            <f:if condition="{demand.showRedirects}">
                <td class="nowrap">
                    <f:for each="{request.mappings}" as="mapping">
                        <f:if condition="{mapping.recordType} === 3">
                            <be:link.editRecord uid="{mapping.uid}"
                                                table="tx_xmgoaccess_domain_model_mapping"
                                                returnUrl="{returnUrl}"
                                                class="btn btn-default btn-sm">
                                <core:icon identifier="mimetypes-x-sys_redirect" size="small" /> Redirect {mapping.uid}
                            </be:link.editRecord>
                        </f:if>
                    </f:for>
                </td>
            </f:if>
            <f:if condition="{demand.showActions}">
                <td class="nowrap">
                    <f:for each="{request.mappings}" as="mapping">
                        <f:if condition="{mapping.recordType} === 1">
                            <be:link.editRecord uid="{mapping.uid}"
                                                table="tx_xmgoaccess_domain_model_mapping"
                                                returnUrl="{returnUrl}"
                                                class="btn btn-default btn-sm">
                                <core:icon identifier="actions-bolt" />
                                {mapping.title}
                            </be:link.editRecord>
                        </f:if>
                    </f:for>
                </td>
            </f:if>
            <f:if condition="{demand.showIgnored}">
                <td class="nowrap">
                    <f:for each="{request.mappings}" as="mapping">
                        <f:if condition="{mapping.recordType} === 2">
                            <core:icon identifier="apps-pagetree-drag-place-denied" size="small" />
                        </f:if>
                    </f:for>
                </td>
            </f:if>
            <td>
                <f:if condition="{request.mapping}">
                    <f:then>
                        <be:link.editRecord uid="{request.mapping.uid}"
                                            table="tx_xmgoaccess_domain_model_mapping"
                                            returnUrl="{returnUrl}"
                                            class="btn btn-default btn-sm">
                            <core:icon identifier="actions-open" size="small" />
                        </be:link.editRecord>
                    </f:then>
                    <f:else>
                        <be:link.newRecord defaultValues="{tx_xmgoaccess_domain_model_mapping: {path:request.path}}"
                                           table="tx_xmgoaccess_domain_model_mapping"
                                           class="btn btn-default btn-sm"
                                           returnUrl="{returnUrl}">
                            <core:icon identifier="actions-add" size="small" />
                        </be:link.newRecord>
                    </f:else>
                </f:if>
            </td>
        </tr>
    </f:for>
    </tbody>
</table>