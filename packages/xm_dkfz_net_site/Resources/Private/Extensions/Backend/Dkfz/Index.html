<html
	xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
	xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
	xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
	data-namespace-typo3-fluid="true">

<f:be.pageRenderer includeRequireJsModules="{0: 'TYPO3/CMS/XmDkfzNetSite/BackendModuleDkfz'}" />

<div class="card-container">
	<div class="card card-size-fixed-small">
		<div class="card-header">
			<div class="card-icon">
				<core:icon identifier="content-clock" size="large"  />
			</div>
			<div class="card-header-body">
				<h1 class="card-title">Last update</h1>
				<span class="card-subtitle"><f:format.date format="d.m.Y H:i">{stat.mtime}</f:format.date></span>
			</div>
		</div>
		<div class="card-body">
			<p>This is the modification date of the cached API response file <code>db.json</code>. This file is updated by a crontab every 15 minutes.</p>
		</div>
	</div>
	<div class="card card-size-fixed-small">
		<div class="card-header">
			<div class="card-icon">
				<core:icon identifier="install-database-analyze" size="large"  />
			</div>
			<div class="card-header-body">
				<h1 class="card-title">Last Import</h1>
				<span class="card-subtitle"><f:format.date format="d.m.Y H:i">{schedulerInfos.lastexecution_time}</f:format.date></span>
			</div>
		</div>
		<div class="card-body">
			<p>This is the time of the last <code>dkfz:importer</code> run. This task was run from the {schedulerInfos.lastexecution_context} context.</p>
		</div>
	</div>
	<div class="card card-size-fixed-small">
		<div class="card-header">
			<div class="card-icon">
				<core:icon identifier="mimetypes-compressed" size="large"  />
			</div>
			<div class="card-header-body">
				<h1 class="card-title">Data size</h1>
				<span class="card-subtitle"><f:format.bytes decimals="2">{stat.size}</f:format.bytes></span>
			</div>
		</div>
		<div class="card-body">
			<p>This data contains <code>{entries->f:count()} user</code> entries and <code>{places->f:count()} places</code></p>
		</div>
	</div>
</div>

<form class="mb-1" id="dkfz-search" onsubmit="event.preventDefault();">
	<div class="input-group">
		<button class="btn btn-default" type="submit" name="search">
			<span class="t3js-icon icon icon-size-small icon-state-default icon-actions-search" data-identifier="actions-search">
				<span class="icon-markup">
					<svg class="icon-color"><use xlink:href="/_assets/1ee1d3e909b58d32e30dcea666dd3224/Icons/T3Icons/sprites/actions.svg#actions-search"></use></svg>
				</span>
			</span>
		</button>
		<label for="search_field" class="visually-hidden">
			Suchbegriff
		</label>
		<input class="form-control" type="search" placeholder="Suchbegriff eingeben" title="Suchbegriff" name="search_field" id="search_field" value="">
	</div>
</form>

<hr />

<h1><span data-entry-count></span> Entries</h1>

<style>
	.hidden-filter { display: none; }
</style>

<table id="dkfz-table" class="table table-striped table-hover mb-0">
	<thead>
		<tr>
			<th></th>
			<th>ID</th>
			<th>Vorname</th>
			<th>Nachname</th>
			<th>Username</th>
			<th>E-Mail</th>
			<th>Abteilungen</th>
		</tr>
	</thead>
	<tbody>
		<f:for each="{entries}" as="entry">
			<tr data-type="frontend" class="hidden">
				<td><core:icon identifier="status-user-frontend" size="small" /></td>
				<td>{entry.id}</td>
				<td>{entry.vorname}</td>
				<td>{entry.nachname}</td>
				<td>{entry.adAccountName}</td>
				<td>{entry.mail}</td>
				<td>
					<f:for each="{entry.abteilung}" as="abt" iteration="i">
						{abt.nummer} ({abt.bezeichnung}) {f:if(condition: i.isLast, else: '<br />')}
					</f:for>
				</td>
			</tr>
			<f:if condition="{entry.intranetRedakteur}">
				<tr data-type="backend">
					<td><core:icon identifier="status-user-backend" size="small" /></td>
					<td>{entry.id}</td>
					<td>{entry.vorname}</td>
					<td>{entry.nachname}</td>
					<td>{entry.adAccountName}</td>
					<td>{entry.mail}</td>
					<td>
						<f:for each="{entry.abteilung}" as="abt" iteration="i">
							{abt.nummer} ({abt.bezeichnung}) {f:if(condition: i.isLast, else: '<br />')}
						</f:for>
					</td>
				</tr>
			</f:if>
		</f:for>
		<f:for each="{places}" as="entry">
			<tr data-type="place" class="hidden">
				<td><core:icon identifier="content-marker" size="small" /></td>
				<td>{entry.id}</td>
				<td>{entry.vorname}</td>
				<td>{entry.nachname}</td>
				<td>{entry.adAccountName}</td>
				<td>{entry.mail}</td>
				<td>
					<f:for each="{entry.abteilung}" as="abt" iteration="i">
						{abt.nummer} ({abt.bezeichnung}) {f:if(condition: i.isLast, else: '<br />')}
					</f:for>
				</td>
			</tr>
		</f:for>
	</tbody>
</table>

</html>
